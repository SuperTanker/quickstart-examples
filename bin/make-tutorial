#!/usr/bin/env node

const fse = require('fs-extra');
const childProcess = require('child_process');
const pathLib = require('path');

const appPath = pathLib.join(__dirname, '../client/web/notepad');
const tutorialPath = pathLib.join(__dirname, '../client/web/tutorial');


console.log('Cleanup previous tutorial in ./client/web/tutorial');

fse.emptyDirSync(tutorialPath);


console.log('Copy ./client/web/notepad to ./client/web/tutorial');

const filterFunc = (src, dest) => {
  if (src.match(/\/node_modules/) || src.match(/\.patch$/)) {
    return false;
  }

  return true;
};

fse.copySync(appPath, tutorialPath, { filter: filterFunc })


console.log('Patch ./client/web/tutorial:');
console.log('  - patch ./README');
console.log('  - patch ./package.json');
console.log('  - patch ./src/Session.js');

childProcess.execSync('patch -p1 < client/web/notepad/tutorial.patch');
